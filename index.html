<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Warden Dashboard - Smart Hostel</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <div class="sidebar">
        <div class="brand">
            <img src="images/warden-photo.jpg" alt="Warden Profile">
            <div class="brand-text">
                <h3>Warden Panel</h3>
                <p>Smart Hostel</p>
            </div>
        </div>

        <ul class="nav-links">
            <li class="active">
                <a href="index.html"><i class="fas fa-th-large"></i> Dashboard</a>
            </li>
            <li>
                <a href="view_student.html"><i class="fas fa-users"></i> View Student</a>
            </li>
            <li>
                <a href="attendance.html"><i class="fas fa-clipboard-check"></i> Attendance</a>
            </li>
            <li>
                <a href="room_allocation.html"><i class="fas fa-door-open"></i> Room Allocation</a>
            </li>
            <li>
                <a href="account.html"><i class="fas fa-user"></i> Account</a>
            </li>
            <li>
                <a href="settings.html"><i class="fas fa-cog"></i> Setting</a>
            </li>
        </ul>

        <div class="logout">
            <a href="#"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </div>

    <div class="main-content">
        <header>
            <div class="header-title">
                <h2>Dashboard</h2>
                <p>Welcome back, Warden</p>
            </div>
            <div class="header-info">
                1/18/2026<br>02:45:00 PM
            </div>
        </header>

        <div class="stats-grid">
            <div class="card blue">
                <div class="card-info">
                    <span>Total Students</span>
                    <h2 id="total-students">0</h2>
                    <p>Registered in hostel</p>
                </div>
                <div class="card-icon"><i class="fas fa-users"></i></div>
            </div>

            <div class="card green">
                <div class="card-info">
                    <span>In Hostel</span>
                    <h2 id="in-hostel">0</h2>
                    <p>Currently present</p>
                </div>
                <div class="card-icon"><i class="fas fa-home"></i></div>
            </div>

            <div class="card red">
                <div class="card-info">
                    <span>Out of Hostel</span>
                    <h2 id="out-hostel">0</h2>
                    <p>Currently away</p>
                </div>
                <div class="card-icon"><i class="fas fa-sign-out-alt"></i></div>
            </div>

            <div class="card orange">
                <div class="card-info">
                    <span>Late Returns</span>
                    <h2 id="late-returns">0</h2>
                    <p>Needs approval</p>
                </div>
                <div class="card-icon"><i class="fas fa-clock"></i></div>
            </div>

            <div class="card purple">
                <div class="card-info">
                    <span>Total Rooms</span>
                    <h2 id="total-rooms">0</h2>
                    <p>Available rooms</p>
                </div>
                <div class="card-icon"><i class="fas fa-door-closed"></i></div>
            </div>

            <div class="card teal">
                <div class="card-info">
                    <span>Occupied Rooms</span>
                    <h2 id="occupied-rooms">0</h2>
                    <p><span id="vacant-rooms">0</span> vacant</p>
                </div>
                <div class="card-icon"><i class="fas fa-bed"></i></div>
            </div>
        </div>

        <div class="activity-section">
            <div class="activity-header">
                <h3>Recent Activity</h3>
                <a href="#">View All</a>
            </div>
            
            <div id="activity-list">
                <p style="padding: 20px;">Loading recent logs...</p>
            </div>
        </div>
    </div>

    <script>
        async function updateDashboard() {
            try {
                // 1. Fetch JSON data from our Node.js API
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                // 2. Update Card Numbers
                document.getElementById('total-students').innerText = data.stats.totalStudents;
                document.getElementById('in-hostel').innerText = data.stats.inHostel;
                document.getElementById('out-hostel').innerText = data.stats.outOfHostel;
                document.getElementById('late-returns').innerText = data.stats.lateReturns;
                document.getElementById('total-rooms').innerText = data.stats.totalRooms;
                document.getElementById('occupied-rooms').innerText = data.stats.occupiedRooms;

                // 3. Dynamic Vacancy Calculation
                document.getElementById('vacant-rooms').innerText = 
                    data.stats.totalRooms - data.stats.occupiedRooms;

                // 4. Build the Activity List
                const container = document.getElementById('activity-list');
                container.innerHTML = ''; // Clear loading message

                data.recentActivity.forEach(item => {
                    const isCheckIn = item.action === "Checked In";
                    const iconColor = isCheckIn ? "green-bg" : "orange-bg";
                    const iconDir = isCheckIn ? "fa-arrow-right" : "fa-arrow-left";
                    const badge = item.status === "Present" ? "green-badge" : "blue-badge";

                    container.innerHTML += `
                        <div class="activity-item">
                            <div class="activity-left">
                                <div class="icon-circle ${iconColor}"><i class="fas ${iconDir}"></i></div>
                                <div>
                                    <strong>${item.name}</strong>
                                    <p>${item.action} â€¢ ${item.reason} <br> ${item.time}</p>
                                </div>
                            </div>
                            <span class="status-badge ${badge}">${item.status}</span>
                        </div>
                    `;
                });
                
                console.log("Dashboard Updated: Connection to Backend Success!");
            } catch (error) {
                console.error("Dashboard Error:", error);
            }
        }

        // Initialize dashboard on load
        window.onload = updateDashboard;
        
    </script>

</body>
</html>